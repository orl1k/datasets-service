{% extends "layout.html" %}

{% block content %}

<form class="ui form error">
    <div class="ui hidden divider"></div>
    <h1 class="ui center aligned icon header ">
        <i class="file alternate outline icon"></i>
        <div class="content">
            DatasetsAPI
            <div class="sub header">Enter script arguments and run the script</div>
        </div>
    </h1>
    <div class="ui hidden divider"></div>

    <h2 class="ui dividing header ">
        <i class="calendar outline icon"></i>
        <div class="content">
            Dataset date
        </div>
    </h2>

    <div class="ui form">
        <div class="field">
            <div class="ui calendar" id="dataset_calendar">
                <div class="ui input left icon">
                    <i class="calendar icon"></i>
                    <input type="text" placeholder="Pick up a date" name="dataset_date" id="dataset_date">
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $('#dataset_calendar')
            .calendar({
                type: 'date',
                formatter: {
                    date: function (date, settings) {
                        if (!date) return '';
                        var day = date.getDate();
                        var month = date.getMonth() + 1;
                        var year = date.getFullYear();
                        return year + '-' + month + '-' + day;
                    }
                }
            })
            ;

    </script>

    <h2 class="ui dividing header">
        <i class="folder outline icon"></i>
        <div class="content">
            Paths
        </div>
    </h2>
    <div class="two fields">
        <div class="field">
            <label>Rasters</label>
            <input name="rasters_path" type="text" placeholder="Enter rasters path" value="/mnt/Gold2/rasters">
        </div>
        <div class="field">
            <label>Datasets</label>
            <input name="datasets_path" type="text" placeholder="Enter datasets path" value="/mnt/Gold1/datasets">
        </div>
    </div>
    <div class="two fields">
        <div class="field">
            <label>Icemaps</label>
            <input name="icemaps_path" type="text" placeholder="Enter icemaps path" value="/mnt/Gold2/ice_maps/KAR">
        </div>
        <div class="field">
            <label>Land shape</label>
            <input name="land_path" type="text" placeholder="Enter land shape path"
                value="/mnt/Gold2/land/bigger/Shore_20191212.shp">
        </div>

    </div>

    <h2 class="ui dividing header">
        <i class="tasks icon"></i>
        <div class="content">
            Other
        </div>
    </h2>

    <div class="ui top attached three column center aligned divided grid segment">
        <div class="column">
            <div class="ui test checkbox">
                <input type="checkbox" name="age" checked="checked">
                <label>age</label>
            </div>
        </div>
        <div class="column">
            <div class="ui test checkbox">
                <input type="checkbox" name="concentrat" checked="checked">
                <label>concentrat</label>
            </div>
        </div>
        <div class="column">
            <div class="ui test checkbox">
                <input type="checkbox" name="age_group" checked="checked">
                <label>age_group</label>
            </div>
        </div>
    </div>
    <div class="ui top attached three column center aligned divided grid segment">
        <div class="column">
            <div class="ui test checkbox">
                <input type="checkbox" name="advanced" checked="checked">
                <label>advanced</label>
            </div>
        </div>
        <div class="column">
            <div class="ui test checkbox">
                <input type="checkbox" name="simple" checked="checked">
                <label>simple</label>
            </div>
        </div>
    </div>
    <div class="ui hidden divider"></div>

    <!-- <div class="ui centered grid"> -->
    <div class="ui basic segment center aligned">
        <button class="ui massive animated button" type="submit" id="submit" tabindex="0">
            <div class="visible content">Start script</div>
            <div class="hidden content">
                <i class="angle double right icon"></i>
            </div>
        </button>
    </div>

    <script>
        $('.ui.form')
            .form({
                fields: {
                    dataset_date: {
                        identifier: 'dataset_date',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please select a dataset date'
                            }
                        ]
                    },
                    rasters_path: {
                        identifier: 'rasters_path',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please select a rasters path'
                            }
                        ]
                    },
                    datasets_path: {
                        identifier: 'datasets_path',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please select a datasets path'
                            }
                        ]
                    },
                    icemaps_path: {
                        identifier: 'icemaps_path',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please select a icemaps path'
                            }
                        ]
                    },
                    land_path: {
                        identifier: 'land_path',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please select a earth shape path'
                            }
                        ]
                    },
                }
            })
            ;
    </script>

    <script>
        $(document).ready(function () {
            $("#submit").click(function (e) {
                e.preventDefault();
                var form = $(this).parents("form:first");
                $.ajax({
                    type: 'POST',
                    url: '/script',
                    data: form.serialize(),
                    success: function (response) {
                        $('body')
                            .toast({
                                title: 'SUCCESS',
                                class: 'success',
                                message: 'Script started with task id: \n' + response['task_id'],
                                showProgress: 'bottom',
                                progressUp: true,
                                position: 'top attached',
                                transition: {
                                    showMethod: 'fade down',
                                    hideMethod: 'fade down',
                                }
                            });
                    },
                    error: function (response) {
                        $('body')
                            .toast({
                                title: 'ERROR',
                                class: 'error',
                                message: 'Script not started',
                                showProgress: 'bottom',
                                progressUp: true,
                                position: 'top attached',
                                transition: {
                                    showMethod: 'fade down',
                                    hideMethod: 'fade down',
                                }
                            });
                    }
                });
            });
        })
    </script>

</form>


{% endblock %}